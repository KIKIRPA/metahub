# MetaHub

Metadata collector application written in Python/FastAPI

## MongoDB

MetaHub requires MongoDB >=5.0.
By default, Metahub will attempt to connect to localhost:27017, with user "kikirpa" and password "hescida". In a production environment, you need to configure these variables. To do this, create a `.env` file in the `src` directory and add the following line, adapted to your specific configuration:

```MONGO_CONN_STR="mongodb://kikirpa:hescida@localhost:27017/"```

### MongoDB in Docker containers

In a development environment, it is possible to use Docker containers as configured in the mongo_container directory. Besides the Mongo container itself, running on localhost:27017, the simple graphical management tool Mongo-Express is configured to run on localhost:8081.

Use the `docker-compose up -d` command in the `mongo_container` directory to download and start the containers in the background.
Before starting the API, verify that the MongoDB container is started by running the `docker-compose ps`. You should see something like:

```text
             Name                            Command               State            Ports          
---------------------------------------------------------------------------------------------------
mongo_container_mongo-express_1   tini -- /docker-entrypoint ...   Up      0.0.0.0:8081->8081/tcp  
mongo_container_mongo_mbapi_1     docker-entrypoint.sh mongod      Up      0.0.0.0:27017->27017/tcp
```

If one or both MongoDB containers are not "up" (in particular mongo-express), rerun `docker-compose up -d`.

## Setting up the MetaHub application

### In a development environment (venv)

To install the requirements for this API, you need to execute the following
commands, at the root of this repository:

```shell
python -m venv venv   # Creating a virtual environment for our application
source venv/bin/activate  # Activating the virtual environment
pip install -r requirements.txt  # Installing requirements
```

Create the database and collections, and seed example data:

```shell
cd src
python setup.py --drop --seed-templates "./seeding_data/templates/*.json"
```

Run the application

```shell
uvicorn main:app --reload
```

The application should now run on [http://127.0.0.1:8000].
You can also visit either [http://127.0.0.1:8000/docs] or [http://127.0.0.1:8000/redoc] to consult the documentation of the API generated by FastAPI.


### In a production environment

(Later...)